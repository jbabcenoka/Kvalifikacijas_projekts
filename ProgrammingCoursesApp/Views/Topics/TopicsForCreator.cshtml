@using ProgrammingCoursesApp.Controllers
@model ProgrammingCoursesApp.ViewModels.TopicsVM

@{
    ViewData["Title"] = "Topics";
}

<link href="https://stackpath.bootstrapcdn.com/bootstrap/4.1.3/css/bootstrap.min.css" rel="stylesheet" />
<script src="https://code.jquery.com/jquery-3.6.0.js"></script>
<script src="https://code.jquery.com/ui/1.13.0/jquery-ui.js"></script>
<link href="https://fonts.googleapis.com/icon?family=Material+Icons" rel="stylesheet">

<h2>Course "@Model.CourseName" topics</h2>

<hr />

<div class="li-content">
    <ol class="topiclist" id="sortable">
        @foreach (var item in Model.Topics)
        {
            <li class="topic-li">
                <a class="topic" asp-controller="Tasks" asp-action="TasksForCoursesCreator" asp-route-id="@item.Id">
                    <h5 class="topic-names">@Html.DisplayFor(modelItem => item.Name)</h5>
                    <span>@Html.DisplayFor(modelItem => item.Description)</span>
                    <i class="material-icons">@(item.IsOpened ? "visibility" : "visibility_off")</i>
                </a>
                <div class="edit-buttons">
                    <a class="btn btn-primary edit-delete-button" asp-action="EditTopic" asp-route-id="@item.Id">Edit</a>
                    <a class="btn btn-danger topic-delete-button" asp-action="DeleteTopic" asp-route-id="@item.Id">Delete</a>
                </div>
            </li>
        }
    </ol>
</div>

<div class="navigation-buttons">
    <a class="btn btn-info back-button" asp-controller="Courses" asp-action="UserCourses">Back to courses</a>
    <a class="btn btn-primary create-topic" asp-action="CreateTopic" asp-route-id="@Model.CourseId">Create topic</a>
</div>

<script>
    function GetTopicsInOrder() {
        var list = new Array();
        var elements = document.getElementsByClassName('topic-names');

        Array.prototype.forEach.call(elements, (function (item) {
            var topicName = item.innerText;
            list.push(topicName);
        }));

        return list;
    }

    $("#sortable").sortable({
        stop: function (evt, ui) {
            $.ajax({
                type: "GET",
                url: "@Url.Action(nameof(TopicsController.ChangeTopicsOrder), "Topics")",
                contentType: "application/json; charset=utf-8",
                traditional: true,
                data: { "id": @Model.CourseId, "topicsInOrder": GetTopicsInOrder() },
                dataType: "json",
                failure: function (jqXHR) {
                    alert("HTTP Status: " + jqXHR.status + "; Error Text: " + jqXHR.responseText);
                }
            })
        }
    });
</script>


<style>
    h2 {
        display: flex;
        justify-content: center;
        margin-top: 50px;
        margin-bottom: 30px;
    }

    .material-icons {
        position: absolute;
        top: 10px;
        right: 10px;
    }

    .empty-info {
        width: 40%;
        margin-bottom: 50px;
        margin-left: 10%;
    }

    .li-content {
        display: flex;
        justify-content: center;
    }

    .edit-buttons {
        text-align: center;
    }

    .navigation-buttons {
        margin-bottom: 100px;
    }

    .back-button {
        margin-left: 5%;
    }

    .create-topic {
        margin-left: 45%;
    }

    .topic-delete-button {
        margin-top: 5px;
    }

    .edit-delete-button, .topic-delete-button {
        width: 100px;
    }

    .topiclist {
        padding: 0;
        list-style: none;
        counter-reset: li;
        width: 90%;
    }


        .topiclist li {
            margin-bottom: 25px;
            display: flex;
            justify-content: start;
        }

        .topiclist h5 {
            font-size: 1.35em;
        }

        .topiclist .topic {
            position: relative;
            width: 90%;
            display: block;
            padding: .8em .4em 0.7em 3em;
            background: #eef3f2;
            color: #444;
            border-radius: .3em;
            margin-bottom: 1em;
            text-decoration: none;
        }

            .topiclist .topic:hover {
                background: #cbe7f8;
            }

            .topiclist .topic:before {
                content: counter(li);
                counter-increment: li;
                position: absolute;
                top: 0px;
                left: -1.5em;
                padding-top: 0.32em;
                vertical-align: middle;
                height: 3em;
                width: 3em;
                border: .3em solid #fff;
                background: #87ceeb;
                text-align: center;
                font-size: 25px;
                border-radius: 2em;
                color: #fff;
            }
</style>
